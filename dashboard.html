<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IoT Dashboard</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="//kendo.cdn.telerik.com/2016.3.914/styles/kendo.common-material.min.css" />
    <link rel="stylesheet" href="//kendo.cdn.telerik.com/2016.3.914/styles/kendo.material.min.css" />
    <link rel="stylesheet" href="//kendo.cdn.telerik.com/2016.3.914/styles/kendo.material.mobile.min.css" />
    
</head>
<body>
    <nav>
        <a href="#lights" onclick="showTab('lights')">Smart Lights</a>
        <a href="#sensors" onclick="showTab('sensors')">Humidity/Temperature</a>
    </nav>

    <div id="lights" class="tab-content active">
        <h1>Smart Light Control</h1>
        <div class="control-panel">
            <img id="switchStatus" src="switch_off.png" alt="Switch is off" onclick="toggleSwitch()" />
            <img id="lightStatus" src="light_off.png" alt="LED is off" />
            <p id="statusText">LED is OFF</p>
        </div>
    </div>

    <div id="sensors" class="tab-content">
        <h1>Humidity and Temperature Monitoring</h1>
        <div class="sensor-panel">
            <p>Humidity: <span id="humidity">--</span>%</p>
            <p>Temperature: <span id="temperature">--</span>°C</p>
        </div>
        <div id="gauge-container">
            <div id="humidityGauge"></div>
            <div id="temperatureGauge"></div>
        </div>


        <!-- Fan display -->
       <div class="ceiling-container">
    <div class="ceiling-fan horizontal left"></div>
    <div class="ceiling-fan horizontal right"></div>
    <div class="ceiling-fan vertical rotated top"></div>
    <div class="ceiling-fan vertical rotated bottom"></div>
</div>
    </div>

    <script src="//kendo.cdn.telerik.com/2016.3.914/js/jquery.min.js"></script>
    <script src="//kendo.cdn.telerik.com/2016.3.914/js/kendo.all.min.js"></script>
    
    <script>
        let isFanActive = false; // Track fan status

        window.addEventListener("load", function () {
            createGauges();
            fetchSensorData();
            setInterval(fetchSensorData, 5000);
        });

        function toggleSwitch() {
            fetch("http://192.168.2.223:5000/toggle")
                .then((response) => response.json())
                .then((data) => {
                    const status = data.status;
                    const switchImg = document.getElementById("switchStatus");
                    const lightImg = document.getElementById("lightStatus");
                    const text = document.getElementById("statusText");

                    if (status === "on") {
                        switchImg.src = "switch_on.png";
                        lightImg.src = "light_on.png";
                        text.innerText = "LED is ON";
                        changeBackground("#FFFFFF");
                    } else {
                        switchImg.src = "switch_off.png";
                        lightImg.src = "light_off.png";
                        text.innerText = "LED is OFF";
                        changeBackground("#696969");
                    }
                })
                .catch((error) => {
                    console.error("Error fetching data:", error);
                });
        }

        function changeBackground(color) {
            document.body.style.background = color;
        }

        function fetchSensorData() {
            fetch("http://192.168.2.223:5000/sensors")
                .then((response) => response.json())
                .then((data) => {
                    if (data.error) {
                        console.error(data.error);
                        document.getElementById("humidity").innerText = "Error";
                        document.getElementById("temperature").innerText = "Error";
                    } else {
                        document.getElementById("humidity").innerText = data.humidity;
                        document.getElementById("temperature").innerText = data.temperature;
                        updateGauges(data.temperature, data.humidity);
                    }
                })
                .catch((error) => {
                    console.error("Error fetching sensor data:", error);
                });
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll(".tab-content");
            tabs.forEach((tab) => {
                tab.classList.remove("active");
            });
            document.getElementById(tabName).classList.add("active");
        }

        function createGauges() {
            // Create Temperature Gauge
            $("#temperatureGauge").kendoRadialGauge({
                pointer: [{
                    value: 0,
                    color: "#c20000",
                    cap: { size: 0.15 }
                }],
                scale: {
                    minorUnit: 5,
                    startAngle: -30,
                    endAngle: 210,
                    min: -20,
                    max: 50,
                    labels: {
                        template: "#= value # °C"
                    },
                    ranges: [
                        { from: -20, to: 0, color: "#00BFFF" },
                        { from: 0, to: 25, color: "#FF7A00" },
                        { from: 25, to: 50, color: "#FF4500" }
                    ]
                }
            });

            // Create Humidity Gauge
            $("#humidityGauge").kendoRadialGauge({
                pointer: [{
                    value: 0,
                    color: "#007acc",
                    cap: { size: 0.15 }
                }],
                scale: {
                    minorUnit: 5,
                    startAngle: -30,
                    endAngle: 210,
                    min: 0,
                    max: 100,
                    labels: {
                        template: "#= value # %"
                    },
                    ranges: [
                        { from: 0, to: 30, color: "#00BFFF" },
                        { from: 30, to: 60, color: "#FF7A00" },
                        { from: 60, to: 100, color: "#FF4500" }
                    ]
                }
            });
        }

        function updateGauges(temperature, humidity) {
            const temperatureGauge = $("#temperatureGauge").data("kendoRadialGauge");
            const humidityGauge = $("#humidityGauge").data("kendoRadialGauge");

            if (temperatureGauge) {
                temperatureGauge.value(temperature);
            } else {
                console.error("Temperature gauge not initialized");
            }

            if (humidityGauge) {
                humidityGauge.value(humidity);
            } else {
                console.error("Humidity gauge not initialized");
            }
        }

        // Function to activate fan
        function activateFan() {
            isFanActive = true;
            const fanDiv = document.getElementById("fan");
            fanDiv.style.display = "block"; // Show the fan
            fanDiv.classList.add("spin"); // Start spinning

            // Stop the fan after 10 seconds
            setTimeout(() => {
                deactivateFan();
            }, 10000);
        }

        function deactivateFan() {
            isFanActive = false;
            const fanDiv = document.getElementById("fan");
            fanDiv.classList.remove("spin"); // Stop spinning
            // Keep the fan displayed but not spinning
        }
    </script>
</body>
</html>
